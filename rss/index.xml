<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Codehaks]]></title><description><![CDATA[Daily adventures of a web developer]]></description><link>https://codehaks.github.io</link><generator>RSS for Node</generator><lastBuildDate>Thu, 07 Sep 2017 11:53:06 GMT</lastBuildDate><atom:link href="https://codehaks.github.io/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[Exploring In-line middlewares]]></title><description><![CDATA[<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In-line middlewares are a simple way to add functionality to ASP.NET Core pipeline without going through a ceremony. In this post I&#8217;m playing with app.Run and app.Use and see how these two work.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simplest_middleware_possible">Simplest middleware possible</h4>
<div class="paragraph">
<p>The best way to understand how a middleware works is to remove the noise around it. so, this is the simples middleware you can build in ASP.NET Core 2.0 .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-C#" data-lang="C#">app.Run(async (context) =&gt;
{
	await context.Response.WriteAsync("Hello World! 0");
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>By the way, that is exactly what you get when you create a new project in Visual studio,using the default template.</p>
</div>
<div class="paragraph">
<p>As this was an exploration, I went a step further and find the actual method in source code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-C#" data-lang="C#">public static void
Run(this IApplicationBuilder app, RequestDelegate handler)
        {
            if (app == null)
            {
                throw new ArgumentNullException(nameof(app));
            }
            if (handler == null)
            {
                throw new ArgumentNullException(nameof(handler));
            }
            app.Use(_ =&gt; handler);
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, basically what run does is calling the app.Use method. but in this case, app.Run does not itroduce any <strong>next</strong> parameter, so no middleware after app.Run would run. This is a short-circuit middleware.</p>
</div>
<div class="paragraph">
<p>Now, lets take a look at app.Use method under the hood :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-C#" data-lang="C#">public static IApplicationBuilder Use(this IApplicationBuilder app, Func&lt;HttpContext, Func&lt;Task&gt;, Task&gt; middleware)
        {
            return app.Use(next =&gt;
            {
                return context =&gt;
                {
                    Func&lt;Task&gt; simpleNext = () =&gt; next(context);
                    return middleware(context, simpleNext);
                };
            });
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is also an Extention method,and returning a <strong>RequestDelegate</strong> . so, what is a RequestDelegate !?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-C#" data-lang="C#">public delegate Task RequestDelegate(HttpContext context);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A request delegate is a function that can process an HTTP request. This function returns a Task indicating the request proccessing has been completed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion">Conclusion</h4>
<div class="paragraph">
<p>We can user app.Use to simulate app.Run method. Basically the app.Run is a simpler version of app.Use. Usually you use app.Run the the end of middleware pipeline because it is a short-circuit middleware and does not call next middleware.</p>
</div>
<div class="paragraph">
<p>There are at least 4 different ways to show "Hello,world!" using in-line middlewares in ASP.NET Core.</p>
</div>
<div class="paragraph">
<p>You can
<a href="https://gist.github.com/codehaks/61d026c46c0293435cab375290c24980">Download the Gist, role="external", window="_blank"</a> here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-C#" data-lang="C#">public class Startup
    {
        public void Configure(IApplicationBuilder app)
        {
            ////--- Default app.Run usage ----------------------------
            // app.Run(async (context) =&gt;
            // {
            //     await context.Response.WriteAsync("Hello World! 0");
            // }); +
            ////--- Default app.Use - short-cricuit--------------------
            // app.Use(async (context, next) =&gt;
            // {
            //     await context.Response.WriteAsync("Hello World! 1");
            // });
            ////--- simulating app.Run with a handler -----------------
            // RequestDelegate handler=async (context) =&gt;
            // {
            //     await context.Response.WriteAsync("Hello World! 2");
            // };
            // app.Use(_ =&gt; handler);
            ////--- simulating app.Run with an anonymous function------
            // app.Use(_ =&gt; async (context) =&gt;
            // {
            //     await context.Response.WriteAsync("Hello World! 3");
            // });
            ////--- simulating app.Run with an anonymous function------
            app.Use( _ =&gt; async (context) =&gt;
            {
                await context.Response.WriteAsync("Hello World! 3");
            });
        }
    }</code></pre>
</div>
</div>
</div>]]></description><link>https://codehaks.github.io/2017/09/07/Exploring-In-line-middlewares.html</link><guid isPermaLink="true">https://codehaks.github.io/2017/09/07/Exploring-In-line-middlewares.html</guid><category><![CDATA[ASP.NET Core]]></category><category><![CDATA[Middleware]]></category><category><![CDATA[Exploring]]></category><dc:creator><![CDATA[Hakim]]></dc:creator><pubDate>Thu, 07 Sep 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[How to create Middleware in ASP Core ?]]></title><description><![CDATA[<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>One of the best features of ASP.NET Core is it&#8217;s flexible pipeline. You can control what goes into your application&#8217;s pipeline and add more to it using a <strong>Middleware</strong>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sendfile_middleware">SendFile Middleware</h4>
<div class="paragraph">
<p>This middleware is just a sample project to see how middlewares are created in ASP.NET Core. I tried to keep it is simple as possible,after all this is my first middleware.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_it_does">What it does?</h4>
<div class="paragraph">
<p>You set a file path at startup and SendFile Middleware sends the file back to user in browser. basically a FileResult directly as a response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c#" data-lang="c#">public class Startup
    {
        public void Configure(IApplicationBuilder app)
        {
            app.UseSendFile(@"C:\myfile.jpg");
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>It can be any kind of file, and user receives it in browser.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sendfile_middleware_explained">SendFile middleware explained</h4>
<div class="paragraph">
<p>The basic parts of a middleware in ASP.NET Core is simple. You have to create a class like this :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-C#" data-lang="C#">internal class SendFileMiddleware
    {
        private readonly RequestDelegate _next;
        private readonly SendFileMiddlewareOptions _options;
        public SendFileMiddleware(RequestDelegate next,
        IOptions&lt;SendFileMiddlewareOptions&gt; options)
        {
            _options = options.Value;
            _next = next;
        }
        public Task Invoke(HttpContext context)
        {
            if (!string.IsNullOrEmpty(_options.FilePath))
            {
            var file = new Microsoft.Extensions.
            FileProviders.Physical.
            PhysicalFileInfo(
                    new System.IO.FileInfo(_options.FilePath));
                context.Response.SendFileAsync(file);
            }
            return this._next(context);
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see there is no inheritance involved. You just have to provide a structure. the <strong>_next</strong> property is a request delegate that you use to pass the reponse to next middleware. There is an <strong>options</strong> parameter. if you want to pass data to your middleware you need an <strong>IOptions</strong> interface. Next there is the <strong>Invoke</strong> method. it takes a HttpContext and creates the response then you pass the response to next middleware. you dont have to pass if your middleware is a short-circuit one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-C#" data-lang="C#">namespace Codehaks.Middlewares.SendFile
{
    public class SendFileMiddlewareOptions
    {
        public string FilePath { get; set; }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_extention_method">The extention method</h4>
<div class="paragraph">
<p>The best way to present your middleware is to create an Extention method and give other developer the option to call it directly with IApplication parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-C#" data-lang="C#">public static class SendFileMiddlewareExtension
    {
        public static IApplicationBuilder UseSendFile(
            this IApplicationBuilder builder,
            SendFileMiddlewareOptions options)
        {
            return
            builder.UseMiddleware&lt;SendFileMiddleware&gt;
            (Options.Create(options));
        }
        public static IApplicationBuilder UseSendFile(
            this IApplicationBuilder builder,
            string filePath)
        {
            var options = new SendFileMiddlewareOptions()
            {
                FilePath = filePath
            };
            return
            builder.UseMiddleware&lt;SendFileMiddleware&gt;
            (Options.Create(options));
        }
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion">Conclusion</h4>
<div class="paragraph">
<p>Middlewares can solve many problems,Creating them is fairly easy and working with them is fun. But there are many things to watch for. Like when you change response it the pipeline the next middleware is not allowed to chat it again,there are some reasons for that. but thats the topic for an other post.
SendFile middleware is availbe as a nuget :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-C#" data-lang="C#">PM &gt; Install-Package Codehaks.Middlewares.SendFile</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can
<a href="view-source:https://github.com/codehaks/Codehaks.Middlewares.SendFile">download</a> source code here.</p>
</div>
</div>]]></description><link>https://codehaks.github.io/2017/09/04/How-to-create-Middleware-in-ASP-Core.html</link><guid isPermaLink="true">https://codehaks.github.io/2017/09/04/How-to-create-Middleware-in-ASP-Core.html</guid><category><![CDATA[ASP.NET]]></category><category><![CDATA[Core]]></category><category><![CDATA[Middleware]]></category><dc:creator><![CDATA[Hakim]]></dc:creator><pubDate>Mon, 04 Sep 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Bare-Minimum Hello world!]]></title><description><![CDATA[<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this post I&#8217;m exploring what is the bare minimum neccesary code to show "Hello Wolrd!" in an ASP.NET Core 2.0 Application. bear with me!</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_template">The template</h4>
<div class="paragraph">
<p>To get the bare minimum in the first place you need to create a  project using "ASP.NET Core Empty" template.</p>
</div>
</div>
<div class="sect3">
<h4 id="_program_cs">Program.cs</h4>
<div class="paragraph">
<p>The most important part that you have to change here is the <strong>CreateDefaultBuilder</strong> Method.There are so many parts that you don&#8217;t need, Like settings a Logging. To do that I used at the source code (Thanks to open-source) and create the host myself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c#" data-lang="c#">using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;
namespace BareMinCore
{
    public class Program
    {
        public static void Main(string[] args)
        {
             var builder = new WebHostBuilder()
                .UseKestrel()
                .UseStartup&lt;Startup&gt;()
                .Build();
            builder.Run();
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_startup_cs">Startup.cs</h4>
<div class="paragraph">
<p>This part is a little tricky. I found out that there is no need for consructor or <strong>ConfigureServices</strong>. But we need the <strong>Configure</strong> method always. Thats how ASP.NET Core 2.0 works anyway. so this is what I end up with :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c#" data-lang="c#">using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Http;
namespace BareMinCore
{
    public class Startup
    {
        public void Configure(IApplicationBuilder app)
        {
            app.Run(async (context) =&gt;
            {
                await context.Response.WriteAsync("Hello World!");
            });
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion">Conclusion</h4>
<div class="paragraph">
<p>It&#8217;s always good to find out what is there and what we actually need to run the system. It helps us to understand how the system is working and how we can improve it using less resources. You can download the result project at my github page.</p>
</div>
</div>]]></description><link>https://codehaks.github.io/2017/08/31/Bare-Minimum-Hello-world.html</link><guid isPermaLink="true">https://codehaks.github.io/2017/08/31/Bare-Minimum-Hello-world.html</guid><category><![CDATA[ASP.NET]]></category><category><![CDATA[Core]]></category><category><![CDATA[Startup]]></category><category><![CDATA[Hosting]]></category><dc:creator><![CDATA[Hakim]]></dc:creator><pubDate>Thu, 31 Aug 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[First 3 days with ASP Core 2.0]]></title><description><![CDATA[<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>About 3 days ago the final version of ASP Core 2.0 released. I installed the new bits and have been playing with it since. here is my experience so far. Fantastic.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_no_bugs">No bugs</h4>
<div class="paragraph">
<p>So far I expericed no bugs. Everything works perfectly. No compatiblity issues like the preview version and no errors. Its fast and reliable.</p>
</div>
</div>
<div class="sect3">
<h4 id="__net_stanard_2_0">.Net Stanard 2.0</h4>
<div class="paragraph">
<p>Its realy the best part of the new version. it feels more matured than the last version. supporting a larg number of older libararies is really what many developers were looking for.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuarion_and_logging_as_a_service">Configuarion and Logging as a service</h4>
<div class="paragraph">
<p>With IConfiguration And ILoggerFactory injected directly into Services
its now accessible from every where in project without any additional code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_razor_pages">Razor pages</h4>
<div class="paragraph">
<p>I always needed this feature. In very projects there is some simple pages that dont have any code behind. And even they do, its almost nothing. now I dont have to create a Model, Controller and View just to show about page. and thats my favorite thing in ASP Core 2.0</p>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion">Conclusion</h4>
<div class="paragraph">
<p>Until last week I was not even considering migrating to ASP Core. Because there were so many uncertainities around the project and there were not much to gain after all.
But now I feel like I can not go back and use the old ASP MVC 5 any more ! yes, It&#8217;s that good.</p>
</div>
</div>]]></description><link>https://codehaks.github.io/2017/08/19/First-3-days-with-ASP-Core-20.html</link><guid isPermaLink="true">https://codehaks.github.io/2017/08/19/First-3-days-with-ASP-Core-20.html</guid><category><![CDATA[ASP.NET]]></category><category><![CDATA[Core]]></category><category><![CDATA[MVC]]></category><dc:creator><![CDATA[Hakim]]></dc:creator><pubDate>Sat, 19 Aug 2017 00:00:00 GMT</pubDate></item></channel></rss>