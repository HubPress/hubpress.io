<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Renewing CERTBOT certificates painlessly</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://manelvf.github.io/blog/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//manelvf.github.io/blog/themes/casper/assets/css/screen.css?v=1499597671838" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <link rel="canonical" href="https://manelvf.github.io/blog/2017/07/09/Renewing-CERTBOT-certificates-painlessly.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="The Fallen Apples" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Renewing CERTBOT certificates painlessly" />
    <meta property="og:description" content="What is &quot;certbot&quot;? Certbot, previously known as Let&amp;#8217;s Encrypt, is a community based effort for developing a service capable to provide secure certificates for everybody in the web. It&amp;#8217;s both a combination of a software that it&amp;#8217;s possible to install in a web server" />
    <meta property="og:url" content="https://manelvf.github.io/blog/2017/07/09/Renewing-CERTBOT-certificates-painlessly.html" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Renewing CERTBOT certificates painlessly" />
    <meta name="twitter:description" content="What is &quot;certbot&quot;? Certbot, previously known as Let&amp;#8217;s Encrypt, is a community based effort for developing a service capable to provide secure certificates for everybody in the web. It&amp;#8217;s both a combination of a software that it&amp;#8217;s possible to install in a web server" />
    <meta name="twitter:url" content="https://manelvf.github.io/blog/2017/07/09/Renewing-CERTBOT-certificates-painlessly.html" />
    
    <script type="application/ld+json">
null
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="The Fallen Apples" href="https://manelvf.github.io/blog/rss/" />
</head>
<body class="post-template nav-closed">

    

    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        
    </nav>
</header>

<main class="content" role="main">
    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Renewing CERTBOT certificates painlessly</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2017-07-09">09 July 2017</time> 
            </section>
        </header>

        <section class="post-content">
            <div class="sect1">
<h2 id="_what_is_certbot">What is "certbot"?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://certbot.eff.org/">Certbot</a>, previously known as <em>Let&#8217;s Encrypt</em>, is a community based effort for developing a service capable to provide secure certificates for everybody in the web. It&#8217;s both a combination of a software that it&#8217;s possible to install in a web server machine and a certificate provider service.</p>
</div>
<div class="sect2">
<h3 id="_why_should_i_use_it">Why should I use it?</h3>
<div class="paragraph">
<p>Web is moving towards secure websites, that respect the privacy of the users and avoid forgeries. Let&#8217;s say it&#8217;s a response to the more complex and unsafe web that we have nowadays. Also, keep in mind that aggregators (like <em>G**gle</em>) are starting to punish websites that don&#8217;t use secure certificates.</p>
</div>
<div class="paragraph">
<p>To use SSL certificates (actually TLS) used to be a problem as the documentation was hard to find and every certificate provider had its own. Not to mention you had to pay for them. That&#8217;s not true anymore, luckily.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gotchas">Gotchas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>But, as usual, not there&#8217;s no <em>perfect</em> system. There are a few minor gotchas, nothing really important, but&#8230;&#8203;</p>
</div>
<div class="sect2">
<h3 id="_creation_and_renewal">Creation and renewal</h3>
<div class="paragraph">
<p>In order to create and renew a certificate, our server has to connect to the certbot web server service in a secure way, so it can check that we are the "owners" of the domain we want to secure  with a certificate. There are a few methods available for that. Shortly, these two are the ones I have used until now:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>webroot</strong>. In this case, a static file served in a folder will help to authenticate the domain in the remote certbot service. Unfortunately, it&#8217;s not possible to do so in all server configurations.</p>
</li>
<li>
<p><strong>standalone</strong>. Using this method, a temporal webserver replaces. It&#8217;s possible. I use this method when dealing with apps served from containers, where the configuration for serving static files is not straight-forward.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>/usr/bin/certbot renew --authenticator standalone --pre-hook "service nginx stop" --post-hook "service nginx start" &gt; certbot.log</pre>
</div>
</div>
<div class="paragraph">
<p>The hooks <strong>disable and reenable</strong> the nginx server during the renewal process, as the standalone server started by certbot needs to replace our app server. A <strong>cron job</strong> calls that line every single day in the middle of the night, so it shouldn&#8217;t be a problem as very few users should be using the service in the middle of the night. Also the outage is minimal in some cases if the certificate is too recent, there will no need for renewing it.</p>
</div>
<div class="paragraph">
<p>Not a perfect solution, but works perfectly well for community websites and it&#8217;s not a serious deal even for more "professional" websites. There are other ways of dealing with this renewal without suspending the service, but they require more work, and I don&#8217;t think they are worth for <strong>small traffic</strong> websites.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rate_limit">Rate Limit</h3>
<div class="paragraph">
<p>One more problem I recently suffer is that <strong>certbot</strong> uses <a href="https://publicsuffix.org/list/public_suffix_list.dat">custom list of domain names</a> for assigning rate limits, currently no more 20 renewals per week per domain, which caused that renewing a couple .GAL (Galician domains) I manage, failed when tried to renew them for not being in that list. In those cases, every renewal of a domain in an unlisted TLD makes it count as it was a single domain, and triggers the Rate Limit exception, forbidding it to renew. Hopefully that will be fixed soon.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I didn&#8217;t pretend to do an exhaustive post about Certbot, only do a little introduction and document some issues I had when using it.</p>
</div>
<div class="paragraph">
<p>You will not believe how much I love <strong>Certbot</strong>. Before that, used to be a big pain to deal with certificates on websites. Certbot not provides them for free (also as in beer), but also provides a very well documented toolchain and documentation on how to use it and the reasons behing its design decissions. So, don&#8217;t hesitate and use it! You will not regret.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bonus">Bonus</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Wildcard certificates</strong> will be available soon. One more reason for migrating to certbot!</p>
</div>
</div>
</div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="https://manelvf.github.io/blog/author/manelvf/" style="background-image: url(https://avatars1.githubusercontent.com/u/135327?v&#x3D;3)"><span class="hidden">Manel Vilar's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="https://manelvf.github.io/blog/author/manelvf/">Manel Vilar</a></h4>

                    <p>Working in Open Source in my spare time, mostly for fun. </p>
                <div class="author-meta">
                    <span class="author-location icon-location">Berlin</span>
                    <span class="author-link icon-link"><a href="manelvf.github.io">manelvf.github.io</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Renewing%20CERTBOT%20certificates%20painlessly&amp;url=https://manelvf.github.io/blog/2017/07/09/Renewing-CERTBOT-certificates-painlessly.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://manelvf.github.io/blog/2017/07/09/Renewing-CERTBOT-certificates-painlessly.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://manelvf.github.io/blog/2017/07/09/Renewing-CERTBOT-certificates-painlessly.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


        <section class="post-comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          var disqus_shortname = 'manelvfgithubio'; // required: replace example with your forum shortname
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </section>


    </article>

</main>

<aside class="read-next">
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="https://manelvf.github.io/blog">The Fallen Apples</a> &copy; 2017</section>
            <section class="poweredby">Proudly published with <a href="http://hubpress.io">HubPress</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>

    <script type="text/javascript" src="//manelvf.github.io/blog/themes/casper/assets/js/jquery.fitvids.js?v=1499597671838"></script>
    <script type="text/javascript" src="//manelvf.github.io/blog/themes/casper/assets/js/index.js?v=1499597671838"></script>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34164255-1', 'auto');
    ga('send', 'pageview');

    </script>
</body>
</html>
