<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Daiquiri : résolution de l&#x27;année</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="//binout.github.io/javaonemorething/themes/Roon/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:400,700,400italic,700italic|Open+Sans:400italic,700italic,700,400">
    <link rel="stylesheet" type="text/css" href="//binout.github.io/javaonemorething/themes/Roon/assets/css/screen.css?v=1.0.0" />

    <link rel="canonical" href="https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html" />
    
    <meta property="og:site_name" content="JavaOneMoreThing" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Daiquiri : résolution de l&#x27;année" />
    <meta property="og:description" content="Non ma résolution de l&amp;#8217;année n&amp;#8217;est pas de boire des cocktails daiquiri ! Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&amp;..." />
    <meta property="og:url" content="https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html" />
    <meta property="article:published_time" content="2013-02-16T23:00:00.000Z" />
    <meta property="article:modified_time" content="2015-12-08T14:01:55.412Z" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Daiquiri : résolution de l&#x27;année" />
    <meta name="twitter:description" content="Non ma résolution de l&amp;#8217;année n&amp;#8217;est pas de boire des cocktails daiquiri ! Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&amp;..." />
    <meta name="twitter:url" content="https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "JavaOneMoreThing",
    "author": {
        "@type": "Person",
        "name": "Benoît Prioux",
        "image": "https://avatars.githubusercontent.com/u/1451016?v=3",
        "url": "undefined/author/undefined",
        "sameAs": "http://javaonemorething.wordpress.com"
    },
    "headline": "Daiquiri : résolution de l&#x27;année",
    "url": "https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html",
    "datePublished": "2013-02-16T23:00:00.000Z",
    "dateModified": "2015-12-08T14:01:55.412Z",
    "description": "Non ma résolution de l&amp;#8217;année n&amp;#8217;est pas de boire des cocktails daiquiri ! Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&amp;..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="JavaOneMoreThing" href="https://binout.github.io/javaonemorething/rss" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
</head>
<body class="post-template  noimage">

    


    <article role="main" class="">
        <header>
            <a href="https://binout.github.io/javaonemorething" id="home_link">«</a>
            <div class="meta"><time datetime="2013-02-17"><a href="/2013/02/17/Daiquiri-resolution-de-lannee.html">February 17, 2013</a></time> <span class="count" id="js-reading-time"></span></div>
            <h1>Daiquiri : résolution de l&#x27;année</h1>
        </header>

        <div class="text" id="js-post-content">
            <div class="paragraph">
<p>Non ma résolution de l&#8217;année n&#8217;est pas de boire des cocktails daiquiri !</p>
</div>
<div class="paragraph">
<p>Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&#8217;ambition pour ce projet, l&#8217;idée est de surtout expérimenter la mise en place une usine logicielle avec les outils "cloud" d&#8217;aujourd&#8217;hui : github, cloudbees.</p>
</div>
<div class="paragraph">
<p>Pourquoi Daiquiri ? C&#8217;est le nom de la librairie utilitaire pour les tests unitaires, que je vous propose. Vous allez me dire mais il y en a déjà plein ! Oui c&#8217;est vrai mais avec cette librairie je veux proposer des solutions à des problèmes bien précis là où les autres s&#8217;arrêtent.</p>
</div>
<div class="paragraph">
<p>J&#8217;ai donc commencé une première implémétation de Daiquiri, en solutionnant un premier problème :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>comment moquer la factory de javax.naming.InitialContext pour vos tests unitaires ?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Exemple :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.daiquiri.examples;

import javax.naming.InitialContext;
import javax.naming.NamingException;

public class LicenseChecker {
	static final String MAX_LICENSE = "MAX_LICENSE";
    private int currentNbUsers = 0;

    public LicenseChecker(int nbUsers) {
    	currentNbUsers = nbUsers;
    }

    public boolean canAddUsers(int nbNewUsers) throws NamingException {
    	Integer maxLicense = (Integer) new InitialContext().lookup(MAX_LICENSE);
        return currentNbUsers + nbNewUsers &lt;= maxLicense;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Les frameworks de mock classiques ne savent pas faire simplement, voici la Solution avec Daiquiri :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.daiquiri.examples;

import static org.daiquiri.Daiquiri.Naming.*;
import org.testng.Assert;
import org.testng.annotations.Test;
import javax.naming.InitialContext;

public class LicenseCheckerTest {
	LicenseChecker checker = new LicenseChecker(10);

    @Test
    public void can_add_users_return_true() throws Exception{
    	InitialContext mockContext = mockInitialContext();
        mockContext.bind(LicenseChecker.MAX_LICENSE, new Integer(15));
        Assert.assertTrue(checker.canAddUsers(4));
    }

    @Test
    public void can_add_users_return_false() throws Exception{
    	InitialContext mockContext = mockInitialContext();
        mockContext.bind(LicenseChecker.MAX_LICENSE, new Integer(15));
        Assert.assertFalse(checker.canAddUsers(6));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vous pouvez trouver les sources sous mon repository github :</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/binout/daiquiri" class="bare">https://github.com/binout/daiquiri</a></p>
</div>
<div class="paragraph">
<p>Et un projet d&#8217;examples :</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/binout/daiquiri-examples" class="bare">https://github.com/binout/daiquiri-examples</a></p>
</div>
<div class="paragraph">
<p>La site de Daiquiri toujours en utilisant github (branche gh-pages du projet) :</p>
</div>
<div class="paragraph">
<p><a href="http://binout.github.io/daiquiri/" class="bare">http://binout.github.io/daiquiri/</a></p>
</div>
<div class="paragraph">
<p>L&#8217;intégration continue est sous BuildHive, proposé gratuitement par Cloudbees et qui est permet en click de mettre son projet sous une version simplifiée de Jenkins adaptée pour github. (Kohsuke en avait parlé à la jenkins conférence en avril l&#8217;année dernière) :</p>
</div>
<div class="paragraph">
<p><a href="https://buildhive.cloudbees.com/job/binout/job/daiquiri/" class="bare">https://buildhive.cloudbees.com/job/binout/job/daiquiri/</a></p>
</div>
<div class="paragraph">
<p>J&#8217;utilise un repository d&#8217;artefacts gratuit avec mon compte Cloudbees :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://repository-binout.forge.cloudbees.com/snapshot/org/daiquiri/daiquiri/">Snapshots</a></p>
</li>
<li>
<p><a href="http://repository-binout.forge.cloudbees.com/release/org/daiquiri/daiquiri/">Release</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Et voici les lignes à mettre dans votre pom.xml, pour la version actuelle daiquiri-0.2 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">	&lt;dependency&gt;
    	&lt;groupId&gt;org.daiquiri&lt;/groupId&gt;
        &lt;artifactId&gt;daiquiri&lt;/artifactId&gt;
        &lt;version&gt;0.2&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;repository&gt;
    	&lt;id&gt;binout-cloudbees-release&lt;/id&gt;
        &lt;name&gt;binout-cloudbees-release&lt;/name&gt;
        &lt;url&gt;https://repository-binout.forge.cloudbees.com/release/&lt;/url&gt;		&lt;/repository&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Et bien sûr, tout est open source sous licence Apache.</p>
</div>
<div class="paragraph">
<p>Si vous avez des idées pour les prochaines versions, n&#8217;hésitez pas à me contacter sur twitter @binout</p>
</div>
<div class="paragraph">
<p>Bon cocktail !</p>
</div>
        </div>

        <menu>
            <a href="" id="btn_share" class="btn" title="Share">
                <span aria-hidden="true" data-icon="S"></span>
                <strong>Share</strong>
            </a>
            <a href="http://twitter.com/share?text=Daiquiri%20%3A%20r%C3%A9solution%20de%20l'ann%C3%A9e&url=https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" id="btn_comment" class="btn" target="_blank">
                <span aria-hidden="true" data-icon="C"></span> Comment on Twitter
            </a>
        </menu>


        <footer class="post-footer" role="contentinfo">

            <div class="vcard">
                <!-- <a href="https://binout.github.io/javaonemorething/rss" id="btn_feed" class="btn" title="Feed" target="_blank">
                    <span aria-hidden="true" data-icon=")"></span>
                    <strong>Feed</strong>
                </a> -->

                <a href="" class="photo">
                    <span style="background-image: url('https://avatars.githubusercontent.com/u/1451016?v=3');">
                        <img src="https://avatars.githubusercontent.com/u/1451016?v=3" alt="Benoît Prioux">
                    </span>
                </a>

                <div class="details">
                    <h4><a href="" class="url n">Benoît Prioux</a></h4>
                    Bordeaux<br>
                    <a href="http://javaonemorething.wordpress.com" class="js-remove-domain-schema">http://javaonemorething.wordpress.com</a>
                </div>
            </div>

            <div id="user_bio">
                <div class="inner">
                    
                </div>
            </div>

        </footer>




    </article>

    <div id="share_modal">
        <div class="wrap">
            <div class="inner">
                <header>
                    Share
                    <a href="" class="close" title="Close">&times;</a>
                </header>

                <div class="roon-share-links">
                    <a href="https://twitter.com/share" class="twitter-share-button" data-dnt="true">Tweet</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

                    <div id="fb-elems">
                        <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                        var js, fjs = d.getElementsByTagName(s)[0];
                        if (d.getElementById(id)) return;
                        js = d.createElement(s); js.id = id;
                        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=463438580397968";
                        fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));</script>
                        <div class="fb-like" data-send="false" data-layout="button_count" data-width="110" data-show-faces="false" data-font="arial"></div>
                    </div>

                    <div id="pinit-btn">
                        <a href="//pinterest.com/pin/create/button/?url=https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html&amp;description=Daiquiri%20%3A%20r%C3%A9solution%20de%20l'ann%C3%A9e-JavaOneMoreThing " data-pin-do="buttonPin" data-pin-config="beside"><img src="//assets.pinterest.com/images/pidgets/pin_it_button.png"></a>
                        <script type="text/javascript" src="//assets.pinterest.com/js/pinit.js"></script>
                    </div>
                </div>
            </div>
        </div>
    </div>






    <script>

            function get_text(el) {
                ret = "";
                var length = el.childNodes.length;
                for(var i = 0; i < length; i++) {
                    var node = el.childNodes[i];
                    if(node.nodeType != 8) {
                        ret += node.nodeType != 1 ? node.nodeValue : get_text(node);
                    }
                }
                return ret;
            }
            function reading_time () {
                var post_content = document.getElementById('js-post-content');
                if (post_content) {
                    var words = get_text(post_content),
                        count = words.split(/\s+/).length,
                        read_time = Math.ceil((count / 150)),
                        read_time_node = document.createTextNode(read_time + ' min read');
                    document.getElementById('js-reading-time').appendChild(read_time_node);
                }
            }

        function no_schema_links () {
            var links = document.querySelectorAll('.js-remove-domain-schema');
            if (links) {
                for (i = 0; i < links.length; ++i) {
                    var link = links[i],
                        text = link.innerHTML,
                        no_schema = text.replace(/.*?:\/\//g, "");
                    link.innerHTML = no_schema;
                }
            }
        }

        window.onload = function () {
            no_schema_links();

            reading_time();
        }
    </script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();      
      </script>

        <script>
            $(function(){
                var share_modal = $("#share_modal"),
                    update_social_links = true;

                $("#btn_share").click(function(){
                    var that = $(this);
                    share_modal.fadeIn(200);
                    return false;
                });

                share_modal.click(function(e){
                    if (e.target.className == "wrap" || e.target.id == "share_modal") {
                        share_modal.fadeOut(200);
                    }
                    return false;
                });

                share_modal.find("div.inner > header > a.close").click(function(){
                    share_modal.fadeOut(200);
                    return false;
                });
            });
        </script>


    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66076881-1', 'auto');
    ga('send', 'pageview');

    </script>

</body>
</html>
