<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Daiquiri : résolution de l&#x27;année</title>
    <meta name="description" content="" />
    <link href="//fonts.googleapis.com/css?family=Noto+Sans:300,400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="//binout.github.io/javaonemorething/themes/Saga/assets/css/style.css?v=1.0.0" rel="stylesheet" type="text/css">
    <link href="//binout.github.io/javaonemorething/themes/Saga/assets/css/animate.min.css?v=1.0.0" rel="stylesheet" type="text/css">
    <link href="//binout.github.io/javaonemorething/themes/Saga/favicon.ico" rel="shortcut icon">
    <link rel="canonical" href="https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html" />
    
    <meta property="og:site_name" content="JavaOneMoreThing" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Daiquiri : résolution de l&#x27;année" />
    <meta property="og:description" content="Non ma résolution de l&amp;#8217;année n&amp;#8217;est pas de boire des cocktails daiquiri ! Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&amp;..." />
    <meta property="og:url" content="https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html" />
    <meta property="article:published_time" content="2013-02-16T23:00:00.000Z" />
    <meta property="article:modified_time" content="2015-10-10T19:25:23.121Z" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Daiquiri : résolution de l&#x27;année" />
    <meta name="twitter:description" content="Non ma résolution de l&amp;#8217;année n&amp;#8217;est pas de boire des cocktails daiquiri ! Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&amp;..." />
    <meta name="twitter:url" content="https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "JavaOneMoreThing",
    "author": {
        "@type": "Person",
        "name": "Benoît Prioux",
        "image": "https://avatars.githubusercontent.com/u/1451016?v=3",
        "url": "undefined/author/undefined",
        "sameAs": "http://javaonemorething.wordpress.com"
    },
    "headline": "Daiquiri : résolution de l&#x27;année",
    "url": "https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html",
    "datePublished": "2013-02-16T23:00:00.000Z",
    "dateModified": "2015-10-10T19:25:23.121Z",
    "description": "Non ma résolution de l&amp;#8217;année n&amp;#8217;est pas de boire des cocktails daiquiri ! Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&amp;..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="JavaOneMoreThing" href="https://binout.github.io/javaonemorething/rss" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
</head>
<body class="post-template">
    <header id="header" class="animated fadeIn">
    <div class="header-background">
    <section class="blog-content">
        <a id="site-url" class="blog-title" href="https://binout.github.io/javaonemorething">JavaOneMoreThing</a>
        <span class="blog-description">Un peu de Java et plus encore</span>
        <nav class="links fadeIn animated">
            <ul>
                <!-- <li class="rss"><a title="RSS Feed" href="/rss/"><i class="fa fa-fw fa-rss-square"></i></a></li> -->
        
            </ul>
        </nav>
    </section>
    <section class="header-content">
        <h1 class="post-title animated fadeInUp">Daiquiri : résolution de l&#x27;année</h1>
        <span class="post-data"><span class="date animated fadeInUp"><i class="fa fa-clock-o"></i> <time class="timesince date" data-timesince="1361055600" datetime="2013-02-17T00:00" title="17 February 2013">2013-02-17 00:00:00<ago class="ago"></time></span>
            
            <span class="author animated fadeInUp"><i class="fa fa-user"></i> <a href="">Benoît Prioux</a></span></span>
    </section>
    </div>
</header>
<main id="main" class="content">
    <article itemtype="http://schema.org/BlogPosting" class="animated fadeIn content post post">
        <section class="post-content">
            <div class="paragraph">
<p>Non ma résolution de l&#8217;année n&#8217;est pas de boire des cocktails daiquiri !</p>
</div>
<div class="paragraph">
<p>Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&#8217;ambition pour ce projet, l&#8217;idée est de surtout expérimenter la mise en place une usine logicielle avec les outils "cloud" d&#8217;aujourd&#8217;hui : github, cloudbees.</p>
</div>
<div class="paragraph">
<p>Pourquoi Daiquiri ? C&#8217;est le nom de la librairie utilitaire pour les tests unitaires, que je vous propose. Vous allez me dire mais il y en a déjà plein ! Oui c&#8217;est vrai mais avec cette librairie je veux proposer des solutions à des problèmes bien précis là où les autres s&#8217;arrêtent.</p>
</div>
<div class="paragraph">
<p>J&#8217;ai donc commencé une première implémétation de Daiquiri, en solutionnant un premier problème :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>comment moquer la factory de javax.naming.InitialContext pour vos tests unitaires ?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Exemple :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.daiquiri.examples;

import javax.naming.InitialContext;
import javax.naming.NamingException;

public class LicenseChecker {
	static final String MAX_LICENSE = "MAX_LICENSE";
    private int currentNbUsers = 0;

    public LicenseChecker(int nbUsers) {
    	currentNbUsers = nbUsers;
    }

    public boolean canAddUsers(int nbNewUsers) throws NamingException {
    	Integer maxLicense = (Integer) new InitialContext().lookup(MAX_LICENSE);
        return currentNbUsers + nbNewUsers &lt;= maxLicense;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Les frameworks de mock classiques ne savent pas faire simplement, voici la Solution avec Daiquiri :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.daiquiri.examples;

import static org.daiquiri.Daiquiri.Naming.*;
import org.testng.Assert;
import org.testng.annotations.Test;
import javax.naming.InitialContext;

public class LicenseCheckerTest {
	LicenseChecker checker = new LicenseChecker(10);

    @Test
    public void can_add_users_return_true() throws Exception{
    	InitialContext mockContext = mockInitialContext();
        mockContext.bind(LicenseChecker.MAX_LICENSE, new Integer(15));
        Assert.assertTrue(checker.canAddUsers(4));
    }

    @Test
    public void can_add_users_return_false() throws Exception{
    	InitialContext mockContext = mockInitialContext();
        mockContext.bind(LicenseChecker.MAX_LICENSE, new Integer(15));
        Assert.assertFalse(checker.canAddUsers(6));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vous pouvez trouver les sources sous mon repository github :</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/binout/daiquiri" class="bare">https://github.com/binout/daiquiri</a></p>
</div>
<div class="paragraph">
<p>Et un projet d&#8217;examples :</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/binout/daiquiri-examples" class="bare">https://github.com/binout/daiquiri-examples</a></p>
</div>
<div class="paragraph">
<p>La site de Daiquiri toujours en utilisant github (branche gh-pages du projet) :</p>
</div>
<div class="paragraph">
<p><a href="http://binout.github.io/daiquiri/" class="bare">http://binout.github.io/daiquiri/</a></p>
</div>
<div class="paragraph">
<p>L&#8217;intégration continue est sous BuildHive, proposé gratuitement par Cloudbees et qui est permet en click de mettre son projet sous une version simplifiée de Jenkins adaptée pour github. (Kohsuke en avait parlé à la jenkins conférence en avril l&#8217;année dernière) :</p>
</div>
<div class="paragraph">
<p><a href="https://buildhive.cloudbees.com/job/binout/job/daiquiri/" class="bare">https://buildhive.cloudbees.com/job/binout/job/daiquiri/</a></p>
</div>
<div class="paragraph">
<p>J&#8217;utilise un repository d&#8217;artefacts gratuit avec mon compte Cloudbees :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://repository-binout.forge.cloudbees.com/snapshot/org/daiquiri/daiquiri/">Snapshots</a></p>
</li>
<li>
<p><a href="http://repository-binout.forge.cloudbees.com/release/org/daiquiri/daiquiri/">Release</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Et voici les lignes à mettre dans votre pom.xml, pour la version actuelle daiquiri-0.2 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">	&lt;dependency&gt;
    	&lt;groupId&gt;org.daiquiri&lt;/groupId&gt;
        &lt;artifactId&gt;daiquiri&lt;/artifactId&gt;
        &lt;version&gt;0.2&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;repository&gt;
    	&lt;id&gt;binout-cloudbees-release&lt;/id&gt;
        &lt;name&gt;binout-cloudbees-release&lt;/name&gt;
        &lt;url&gt;https://repository-binout.forge.cloudbees.com/release/&lt;/url&gt;		&lt;/repository&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Et bien sûr, tout est open source sous licence Apache.</p>
</div>
<div class="paragraph">
<p>Si vous avez des idées pour les prochaines versions, n&#8217;hésitez pas à me contacter sur twitter @binout</p>
</div>
<div class="paragraph">
<p>Bon cocktail !</p>
</div>
        </section>

    </article>

</main>
    <footer class="animated fadeIn" id="footer">
        <section class="colophon">
          <section class="copyright">Copyright &copy; <span itemprop="copyrightHolder">JavaOneMoreThing</span>. <span rel="license">All Rights Reserved</span>.</section>
          <section class="poweredby">Published with <a class="icon-ghost" href="http://hubpress.io">HubPress</a></section>
        </section>
        <section class="bottom">
          <section class="attribution">
            <a href="http://github.com/Reedyn/Saga">Built with <i class="fa fa-heart"></i> and Free and Open-Source Software</a>.
          </section>
        </section>
    </footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();      
      </script>
    <script src="//binout.github.io/javaonemorething/themes/Saga/assets/js/scripts.js?v=1.0.0"></script>
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66076881-1', 'auto');
    ga('send', 'pageview');

    </script>
</body>
</html>
