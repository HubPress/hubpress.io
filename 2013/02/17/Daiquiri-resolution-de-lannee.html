<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Daiquiri : résolution de l&#x27;année</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="//binout.github.io/javaonemorething/themes/ichi/favicon.ico">

    <script type="text/javascript" src="//binout.github.io/javaonemorething/themes/ichi/assets/js/vendor/fastclick.js?v=1.0.0"></script>
    <script type="text/javascript" src="//binout.github.io/javaonemorething/themes/ichi/assets/js/vendor/modernizr.js?v=1.0.0"></script>


    <link rel="stylesheet" type="text/css" href="//binout.github.io/javaonemorething/themes/ichi/assets/css/normalize.css?v=1.0.0" />
    <link rel="stylesheet" type="text/css" href="//binout.github.io/javaonemorething/themes/ichi/assets/css/foundation.min.css?v=1.0.0" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" type="text/css" href="//binout.github.io/javaonemorething/themes/ichi/assets/css/outdatedBrowser.min.css?v=1.0.0">
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="//binout.github.io/javaonemorething/themes/ichi/assets/fonts/foundation-icons/foundation-icons.css?v=1.0.0" />
    <link rel="stylesheet" type="text/css" href="//binout.github.io/javaonemorething/themes/ichi/assets/css/styles.css?v=1.0.0" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans:300,700,400|Source+Sans+Pro:300,400,600,700,900,300italic,400italic,600italic,700italic,900italic" />

    <link rel="canonical" href="https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html" />
    
    <meta property="og:site_name" content="JavaOneMoreThing" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Daiquiri : résolution de l&#x27;année" />
    <meta property="og:description" content="Non ma résolution de l&amp;#8217;année n&amp;#8217;est pas de boire des cocktails daiquiri ! Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&amp;..." />
    <meta property="og:url" content="https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html" />
    <meta property="article:published_time" content="2013-02-16T23:00:00.000Z" />
    <meta property="article:modified_time" content="2015-08-07T13:01:08.305Z" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Daiquiri : résolution de l&#x27;année" />
    <meta name="twitter:description" content="Non ma résolution de l&amp;#8217;année n&amp;#8217;est pas de boire des cocktails daiquiri ! Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&amp;..." />
    <meta name="twitter:url" content="https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "JavaOneMoreThing",
    "author": {
        "@type": "Person",
        "name": "Benoît Prioux",
        "image": "https://avatars.githubusercontent.com/u/1451016?v=3",
        "url": "undefined/author/undefined",
        "sameAs": "http://javaonemorething.wordpress.com"
    },
    "headline": "Daiquiri : résolution de l&#x27;année",
    "url": "https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html",
    "datePublished": "2013-02-16T23:00:00.000Z",
    "dateModified": "2015-08-07T13:01:08.305Z",
    "description": "Non ma résolution de l&amp;#8217;année n&amp;#8217;est pas de boire des cocktails daiquiri ! Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&amp;..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="JavaOneMoreThing" href="https://binout.github.io/javaonemorething/rss" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
</head>
<body class="post-template">

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdate" href="http://outdatedbrowser.com/">Update my browser now</a></p>
</div>

<nav class="top-bar hide-for-large-up" data-topbar >
  <ul class="title-area">
    <li class="name">

    </li>
    <li class="home"><a class="fi-home" href="https://binout.github.io/javaonemorething"></a></li>
    <li class="toggle-topbar"><a href="#" id="trigger-overlay" class="fi-list"></a></li>
  </ul>

<div class="overlay overlay-scale">
    <button type="button" class="overlay-close">Close</button>
    <nav>
        <ul>
            <li><a href="https://binout.github.io/javaonemorething">Home</a></li>
        </ul>
    </nav>
</div>

</nav>

<div class="row">

<div class="small-16 medium-16 large-4 columns right head-area" >

<header class="site-head">
    <div class="vertical">
        <div class="site-head-content inner">
            <ul class="side-nav blog-menu show-for-large-up">
                <li><a class="fi-home" href="https://binout.github.io/javaonemorething"></a></li>
                <li><a class="fi-torso" href="https://binout.github.io/javaonemorething/about"></a></li>
                <li><a class="fi-mail" href="https://binout.github.io/javaonemorething/contact"></a></li>
            </ul>
            
            <h1 class="blog-title">JavaOneMoreThing</h1>
            <hr>
            <p class="blog-description">Un peu de Java et plus encore</p>
            <div class="blog-network">
<!--                 <a href="#" class="fi-social-pinterest"></a>
                <a href="#" class="fi-social-linkedin"></a>
                <a href="#" class="fi-social-behance"></a>
                <a href="#" class="fi-social-deviant-art"></a>
                <a href="#" class="fi-social-dribbble"></a>
                <a href="#" class="fi-social-flickr"></a>
                <a href="#" class="fi-social-github"></a>
                <a href="#" class="fi-social-skype"></a>
                <a href="#" class="fi-social-snapchat"></a>
                <a href="#" class="fi-social-steam"></a>
                <a href="#" class="fi-social-xbox"></a>
                <a href="#" class="fi-social-reddit"></a> -->
                  <a href="binout" class="fi-social-github"></a>
                  <a href="binout" class="fi-social-twitter"></a>
            </div>
        </div>
    </div>
</header>

</div>


<div class="small-16 medium-16 large-12 columns main-column left">
    

<main class="content" role="main">

    <article class="post">


            <h1 class="post-title">Daiquiri : résolution de l&#x27;année</h1>

            <span class="post-meta label"><time datetime="2013-02-17">17 Feb 2013</time></span>

            <section class="post-content">
                <div class="paragraph">
<p>Non ma résolution de l&#8217;année n&#8217;est pas de boire des cocktails daiquiri !</p>
</div>
<div class="paragraph">
<p>Pour cette année 2013, je me suis donné comme résolution de commencer un projet personnel open source. Je ne veux pas avoir trop d&#8217;ambition pour ce projet, l&#8217;idée est de surtout expérimenter la mise en place une usine logicielle avec les outils "cloud" d&#8217;aujourd&#8217;hui : github, cloudbees.</p>
</div>
<div class="paragraph">
<p>Pourquoi Daiquiri ? C&#8217;est le nom de la librairie utilitaire pour les tests unitaires, que je vous propose. Vous allez me dire mais il y en a déjà plein ! Oui c&#8217;est vrai mais avec cette librairie je veux proposer des solutions à des problèmes bien précis là où les autres s&#8217;arrêtent.</p>
</div>
<div class="paragraph">
<p>J&#8217;ai donc commencé une première implémétation de Daiquiri, en solutionnant un premier problème :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>comment moquer la factory de javax.naming.InitialContext pour vos tests unitaires ?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Exemple :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.daiquiri.examples;

import javax.naming.InitialContext;
import javax.naming.NamingException;

public class LicenseChecker {
	static final String MAX_LICENSE = "MAX_LICENSE";
    private int currentNbUsers = 0;

    public LicenseChecker(int nbUsers) {
    	currentNbUsers = nbUsers;
    }

    public boolean canAddUsers(int nbNewUsers) throws NamingException {
    	Integer maxLicense = (Integer) new InitialContext().lookup(MAX_LICENSE);
        return currentNbUsers + nbNewUsers &lt;= maxLicense;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Les frameworks de mock classiques ne savent pas faire simplement, voici la Solution avec Daiquiri :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.daiquiri.examples;

import static org.daiquiri.Daiquiri.Naming.*;
import org.testng.Assert;
import org.testng.annotations.Test;
import javax.naming.InitialContext;

public class LicenseCheckerTest {
	LicenseChecker checker = new LicenseChecker(10);

    @Test
    public void can_add_users_return_true() throws Exception{
    	InitialContext mockContext = mockInitialContext();
        mockContext.bind(LicenseChecker.MAX_LICENSE, new Integer(15));
        Assert.assertTrue(checker.canAddUsers(4));
    }

    @Test
    public void can_add_users_return_false() throws Exception{
    	InitialContext mockContext = mockInitialContext();
        mockContext.bind(LicenseChecker.MAX_LICENSE, new Integer(15));
        Assert.assertFalse(checker.canAddUsers(6));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vous pouvez trouver les sources sous mon repository github :</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/binout/daiquiri" class="bare">https://github.com/binout/daiquiri</a></p>
</div>
<div class="paragraph">
<p>Et un projet d&#8217;examples :</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/binout/daiquiri-examples" class="bare">https://github.com/binout/daiquiri-examples</a></p>
</div>
<div class="paragraph">
<p>La site de Daiquiri toujours en utilisant github (branche gh-pages du projet) :</p>
</div>
<div class="paragraph">
<p><a href="http://binout.github.io/daiquiri/" class="bare">http://binout.github.io/daiquiri/</a></p>
</div>
<div class="paragraph">
<p>L&#8217;intégration continue est sous BuildHive, proposé gratuitement par Cloudbees et qui est permet en click de mettre son projet sous une version simplifiée de Jenkins adaptée pour github. (Kohsuke en avait parlé à la jenkins conférence en avril l&#8217;année dernière) :</p>
</div>
<div class="paragraph">
<p><a href="https://buildhive.cloudbees.com/job/binout/job/daiquiri/" class="bare">https://buildhive.cloudbees.com/job/binout/job/daiquiri/</a></p>
</div>
<div class="paragraph">
<p>J&#8217;utilise un repository d&#8217;artefacts gratuit avec mon compte Cloudbees :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://repository-binout.forge.cloudbees.com/snapshot/org/daiquiri/daiquiri/">Snapshots</a></p>
</li>
<li>
<p><a href="http://repository-binout.forge.cloudbees.com/release/org/daiquiri/daiquiri/">Release</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Et voici les lignes à mettre dans votre pom.xml, pour la version actuelle daiquiri-0.2 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">	&lt;dependency&gt;
    	&lt;groupId&gt;org.daiquiri&lt;/groupId&gt;
        &lt;artifactId&gt;daiquiri&lt;/artifactId&gt;
        &lt;version&gt;0.2&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;repository&gt;
    	&lt;id&gt;binout-cloudbees-release&lt;/id&gt;
        &lt;name&gt;binout-cloudbees-release&lt;/name&gt;
        &lt;url&gt;https://repository-binout.forge.cloudbees.com/release/&lt;/url&gt;		&lt;/repository&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Et bien sûr, tout est open source sous licence Apache.</p>
</div>
<div class="paragraph">
<p>Si vous avez des idées pour les prochaines versions, n&#8217;hésitez pas à me contacter sur twitter @binout</p>
</div>
<div class="paragraph">
<p>Bon cocktail !</p>
</div>
                        <aside class="tags fi-pricetag-multiple">No tag</aside>
            </section>
            <hr>
            <footer class="post-footer">

                <section class="share">
                    <h4>Liked this post ? Share it.</h4>
                    <a class="fi-social-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html"
                        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    </a>
                    <a class="fi-social-twitter" href="https://twitter.com/share?text=Daiquiri%20%3A%20r%C3%A9solution%20de%20l'ann%C3%A9e&amp;url=https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html"
                        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    </a>
                    <a class="fi-social-google-plus" href="https://plus.google.com/share?url=https://binout.github.io/javaonemorething/2013/02/17/Daiquiri-resolution-de-lannee.html"
                       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    </a>
                </section>

                <section class="author">
                    <header>
                        <span>About the author</span>
                    </header>
                    <section>
                        <h4>Benoît Prioux</h4>
                        <img src="https://avatars.githubusercontent.com/u/1451016?v=3">
                        <span>Bordeaux</span>
                        <a href="http://javaonemorething.wordpress.com">http://javaonemorething.wordpress.com</a>
                    </section>
                    <footer>
                         <p></p>
                    </footer>
                </section>

        <div class="clearfix"></div>
                    <hr>

            </footer>

        <h3 class="title-disqus"><span class="fi-comments"></span>Discussions</h3>




    </article>

</main>

</div>

</div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();      
      </script>

    <!--[if lte IE 8]>
        <script type="text/javascript" src="//binout.github.io/javaonemorething/themes/ichi/assets/js/outdatedBrowser.min.js?v=1.0.0"></script>
    <![endif]-->
    <script type="text/javascript" src="//binout.github.io/javaonemorething/themes/ichi/assets/js/min/built.js?v=1.0.0"></script>

    <script>
      $(document).foundation();
    </script>

</body>
</html>
